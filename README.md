#  Тестовое задание

### Развертывание с использованием Docker

Перед запуском приложения необходимо откорректировать переменные окружения для образа с фронтендом в файле `docker-compose.yml`.
```yml
front_app:
    image: "geos74/test-task-front"
    ports:
      - "3000:3000"
    environment:
      - SERVER_PORT=3000
      - BACKEND_HOST=localhost
      - BACKEND_PORT=3500
```

Переменная `SERVER_PORT` - устанавливает порт, на котором будет доступно фронтенд приложение.
Переменная `BACKEND_HOST` - устанавливает хост для бэкенд приложение.

>**Важно!!!** переменная `BACKEND_HOST` должна соответствовать хосту, где запускается приложение. Например, если приложение разворачивается на локальной машине, то значение переменной может быть `localhost`, если приложение разворачивается где-то на VDS, то значение должно соответствовать ip-адресу хоста или доменному имени.
 
Запустить приложение можно командой:

```bash
docker compose up -d
```

#### Инициализация базы данных

При запуске приложения с использованием Docker, база данных автоматически инициализируется и наполняется минимальными данными для тестов.

В случае если наполнять базу данных тестовыми значениями не требуется, то перед запуском приложения необходимо удалить все команды создания записей `INSERT INTO ...` в файле `./libs/db.init.sql`.

#### Использование приложения

После успешного запуска приложения, на главной странице проекта доступно 3 ссылки:
1) страница с ER-диаграммой;
2) страница с кнопками для запросов по тестовому заданию;
2) страница с кнопками для дополнительных запросов.

### Развертывание приложения на локальной машине

После клонирования проекта, выполнить: 
```bash
npm install
```

Для инициализации базы данных выполнить:
```bash
npm run db:init
```

Для наполнения базы данных тестовыми значениями выполнить:
```bash
node fixtures/index
```

Для запуска приложения:
```bash
node index
```

### Скрипты package.json

Создать базу данных и таблицы:
```bash
npm run db:init
```

Удалить базу данных:
```bash
npm run db:drop
```

Запустить линтер:
```bash
npm run lint
```

Запустить линтер в режиме исправления проблем:
```bash
npm run lint:fix
```

### Образ фронтенд приложения

Образ фронтенд приложения залит на Docker Hub:
[geos74/test-task-front](https://hub.docker.com/r/geos74/test-task-front)

### Взаимодействие с базой данных

Для взаимодействия с таблицами базы данных для каждой таблицы реализовано CRUD API.
Каждое API доступно по своему префиксу:

1) префикс `/api/company` - для таблицы наименований компаний
2) префикс `/api/customer` - для таблицы заказчиков
3) префикс `/api/leftover` - для таблицы с остатками на складах
4) префикс `/api/product` - для таблицы наименований продуктов
5) префикс `/api/stock` - для таблицы складов
6) префикс `/api/shop` - для таблицы магазинов
7) префикс `/api/sale` - для таблицы с продажами

Эти префиксы используются при обращении к CRUD API (см. ниже)

##### Получить все записи
маршрут: `GET <prefix>/`

Возвращает статус 200 и json структуру в теле ответа.

##### Получить определённую запись
маршрут: `GET <prefix>/:id`,

где `:id` - идентификатор записи.

Возвращает статус 200 и json структуру в теле ответа.

##### Добавить новую запись
маршрут: `POST <prefix>/`,

Возвращает статус 201 и json структуру в теле ответа.

##### Изменить запись
маршрут: `PATCH <prefix>/:id`,

где `:id` - идентификатор записи.

Возвращает статус 200 и json структуру в теле ответа.

##### Удалить запись
маршрут: `DELETE <prefix>/:id`,

где `:id` - идентификатор записи.

Возвращает статус 200 и json структуру в теле ответа.

#### Обработка ошибок

В случае возникновения ошибки, сервер ответит статусом отличным от 200 или 201 и в теле ответа вернёт json структуру с описанием ошибки.
